webpackJsonp([11],{JJfN:function(e,t){},kWZm:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("//Fk"),s=a.n(n),o=a("QyUb"),i=a("/dzA"),r={name:"apis",data:function(){return{tableData:[],appMeta:"",appName:""}},mounted:function(){this.fetchData()},computed:{},methods:{filterTag:function(e,t){return t.tag===e},fetchData:function(){var e=this;Object(i.b)(o.a.app.one+this.$route.query.id).then(function(t){if(0===t.code){e.$message({message:"获取应用API成功",type:"success"}),e.appName=t.data.name;var a=JSON.parse(t.data.metas);e.appMeta=a.name+" "+a.host+" "+a.port;var n=a.apis,s=[];t.onData&&(s=t.onData.apis),s=s.map(function(e){return e.name}),n=n.map(function(e){return s.indexOf(e.name)>-1?(e.tag="正在运行",e.on=!0):(e.on=!1,e.tag="未运行"),e}),e.tableData=n,console.log(n),console.log(s)}else e.$message({message:t.msg,type:"warning"})})},deploy:function(e,t){var a=this;console.log(t),Object(i.c)(o.a.app.api.deploy+this.appName,"",t).then(function(e){0===e.code?(a.$message({message:"启动API"+t.name+"成功",type:"success"}),t.on=!0,t.tag="运行中"):a.$message({message:e.msg,type:"warning"})})},unDeploy:function(e,t){var a=this;return Object(i.a)(o.a.app.api.undeploy+this.appName+"/"+t.name).then(function(e){return 0===e.code?(a.$message({message:"关闭API"+t.name+"成功",type:"success"}),t.on=!1,t.tag="未运行",!0):(a.$message({message:e.msg,type:"warning"}),!1)})},deleteApi:function(e,t){var a=this;this.$confirm("确认删除API，将无法恢复？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){new s.a(function(n){t.on?a.unDeploy(e,t).then(function(e){return n(e)}):n(!0)}).then(function(n){n&&Object(i.a)(o.a.app.api.del+a.$route.query.id+"/"+t.name).then(function(t){0===t.code?(a.$message({message:"删除API成功",type:"warning"}),a.tableData.splice(e,1)):a.$message({message:t.msg,type:"warning"})})})}).catch(function(){})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dashboard"},[a("el-card",{attrs:{shadow:"never"}},[a("el-row",[a("el-col",{attrs:{span:"12"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.$router.push({path:"/app/apis/create",query:e.$route.query})}}},[e._v("添加API")])],1),e._v(" "),a("el-col",{attrs:{span:"12"}},[a("div",{staticStyle:{height:"40px","line-height":"40px"}},[a("el-tag",{attrs:{"disable-transitions":""}},[e._v(e._s(e.appMeta))])],1)])],1)],1),e._v(" "),a("div",{staticClass:"hold"}),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{prop:"name",label:"API名字",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"path",label:"API请求路径"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"简述"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tag",label:"标签",width:"100",filters:[{text:"未运行",value:"未运行"},{text:"运行中",value:"运行中"}],"filter-method":e.filterTag,"filter-placement":"bottom-end"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"未运行"===t.row.tag?"primary":"success","disable-transitions":""}},[e._v(e._s(t.row.tag))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button-group",[t.row.on?e._e():a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.$router.push({path:"/app/apis/edit",query:{data:JSON.stringify(t.row),id:e.$route.query.id}})}}},[e._v("编辑")]),e._v(" "),!t.row.on&&e.$route.query.on?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){e.deploy(t.$index,t.row)}}},[e._v("启动")]):e._e(),e._v(" "),t.row.on?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){e.unDeploy(t.$index,t.row)}}},[e._v("关闭")]):e._e(),e._v(" "),t.row.on?e._e():a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.deleteApi(t.$index,t.row)}}},[e._v("删除")])],1)]}}])})],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,l,!1,function(e){a("JJfN")},"data-v-0b51e980",null);t.default=c.exports}});